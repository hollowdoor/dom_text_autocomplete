{"version":3,"file":"bundle.es.js","sources":["../src/index.js"],"sourcesContent":["import { toElement } from 'dom-elementals';\nimport matches from 'matches-selector';\nimport camelcase from 'camelcase';\n\nclass DOMTextAutocomplete {\n    constructor(input, {\n        parent = '<ol></ol>',\n        classes = {},\n        target = null,\n        dataKey = 'value',\n        display = 'block',\n        select = function(value){\n            this.input.value = value;\n            this.hide();\n        },\n        activate = function(){\n            this.show();\n        },\n        children = []\n    } = {}){\n        const self = this;\n\n        try{\n            this.input = typeof input === 'string'\n            ? document.querySelector(input)\n            : input;\n        }catch(e){\n            throw e;\n        }\n\n        let {\n            main = 'main-target',\n            data = 'value-target',\n            selected = 'auto-selected'\n        } = (classes || {});\n\n        classes = this.classes = {\n            main, data, selected\n        };\n\n        this.display = display;\n        this.dataKey = dataKey;\n\n        const dataProp = this.dataProp = camelcase(dataKey);\n\n        this.element = toElement(parent);\n        this.element.style.opacity = 0;\n\n        function onArrow(event){\n            if(self.visible){\n                let selected = self.element.querySelector('.'+selected);\n                let children = self.children;\n                if(!selected){\n                    this.choose(0);\n                }else{\n                    let index = children.indexOf(selected);\n                    this.choose(index);\n                }\n            }\n        }\n\n        function onKeyup(event){\n            activate.call(self, event);\n            if(self.visible){\n                if(event.keyCode === 40){\n                    self.choose(1);\n                }else if(event.keyCode === 38){\n                    self.choose(-1);\n                }\n            }\n        }\n\n        input.addEventListener('keyup', onKeyup, false);\n\n        children.forEach(child=>this.push(child));\n\n        let down = false, downListener;\n\n\n        function onDown(event){\n            if(!down){\n                down = true;\n                let el = getTarget(event.target, targets);\n                select.call(self, el.dataset[dataKey], el);\n            }\n        }\n\n        function onUp(event){\n            down = false;\n        }\n\n        downListener = onDown;\n\n        this.element.addEventListener('mousedown', onDown, false);\n        this.element.addEventListener('mouseup', onUp, false);\n\n\n        this.destroy = function(){\n            this.remove();\n        };\n    }\n    show(){\n\n        this.forEach(el=>{\n            el = getTarget(el, this.classes);\n            if(el.dataset[this.dataKey].indexOf(this.input.value) === 0){\n                el.style.display = this.display;//'block';\n            }else{\n                el.style.display = 'none';\n            }\n        });\n\n        this.element.style.opacity = 1;\n    }\n    forEach(callback){\n        this.children.forEach(callback);\n    }\n    get children(){\n        return Array.prototype.slice.call(this.element.children);\n    }\n    get visible(){\n        return !!this.element.style.opacity;\n    }\n    choose(direction){\n        console.log('direction ',direction)\n        if([-1, 1].indexOf(direction) === -1){\n            return;\n        }\n\n        let className = this.classes.selected;\n        console.log(className)\n        let selected = this.element.querySelector('.'+className);\n        console.log('selected ',selected)\n        let children = this.children;\n        let index = selected\n        ? children.indexOf(selected) + direction : 0;\n        console.log('index ', index);\n        if(direction === 1){\n            for(let i=index; i<children.length; ++i){\n                console.log('display ',children[i].style.display)\n                if(children[i].style.display !== 'none'){\n                    children[i].classList.add(className);\n                    break;\n                }\n            }\n        }else{\n            for(let i=index; i>=0; --i){\n                console.log('display ',children[i].style.display)\n                if(children[i].style.display !== 'none'){\n                    children[i].classList.add(className);\n                    break;\n                }\n            }\n        }\n\n        if(selected){\n            selected.classList.remove(className);\n        }\n\n    }\n    hide(){\n        this.element.style.opacity = 0;\n    }\n    push(value){\n        this.element.appendChild(toElement(value));\n        return this;\n    }\n    replace(values){\n        values.forEach(value=>this.push(value));\n        return this;\n    }\n    appendTo(el){\n        el.appendChild(this.element);\n        return this;\n    }\n    remove(){\n        if(this.element.parentNode){\n            return this.element.parentNode.removeChild(this.element);\n        }\n    }\n}\n\nexport default function autoComplete(input, options){\n    return new DOMTextAutocomplete(input, options);\n}\n\nfunction getTarget(target, targets){\n    if(matches(target, '.'+targets.main)){\n        return target;\n    }\n\n    if(target.children.length && !matches(target, '.'+targets.data)){\n        return el.querySelector('.'+targets.data);\n    }\n    return target;\n}\n\nfunction makeSelection(children, className, start){\n    for(let i=start; i<children.length; i++){\n        if(children[i].style.display !== 'none'){\n            children[i].classList.add(className);\n        }\n    }\n}\n"],"names":["this","let","i"],"mappings":"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"}